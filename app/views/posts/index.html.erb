<div class="max-w-2xl mx-auto">
  <!-- Post Creation Form -->
  <div class="bg-white rounded-lg shadow p-6 mb-6">
    <h2 class="text-lg font-semibold mb-4">What's on your mind?</h2>

    <%= form_with model: @post, local: true, class: "space-y-4" do |form| %>
      <% if @post.errors.any? %>
        <div class="bg-red-50 border border-red-200 rounded-md p-4">
          <h4 class="text-red-800 font-medium">Please fix the following errors:</h4>
          <ul class="mt-2 text-sm text-red-600">
            <% @post.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div>
        <%= form.text_area :content,
            placeholder: "Share something interesting...",
            rows: 3,
            maxlength: 280,
            class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none" %>
        <p class="text-xs text-gray-500 mt-1">
          <span id="char-count">0</span>/280 characters
        </p>
      </div>

      <div class="flex justify-end">
        <%= form.submit "Post",
            class: "bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 disabled:bg-gray-300",
            id: "post-submit" %>
      </div>
    <% end %>
  </div>

  <!-- Feed -->
  <div class="space-y-4">
    <% if @posts.any? %>
      <% @posts.each do |post| %>
        <div class="bg-white rounded-lg shadow p-6">
          <div class="flex items-start space-x-3">
            <!-- Avatar -->
            <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0">
              <%= post.user.name.first.upcase %>
            </div>

            <!-- Post Content -->
            <div class="flex-1 min-w-0">
              <div class="flex items-center space-x-2">
                <h3 class="font-semibold text-gray-900">
                  <%= post.user.account&.name || post.user.name %>
                </h3>
                <% if post.user.account&.handle %>
                  <span class="text-gray-500 text-sm">@<%= post.user.account.handle %></span>
                <% end %>
                <span class="text-gray-400 text-sm">Â·</span>
                <time class="text-gray-400 text-sm" datetime="<%= post.created_at.iso8601 %>">
                  <%= time_ago_in_words(post.created_at) %> ago
                </time>
              </div>

              <div class="mt-2">
                <p class="text-gray-900 whitespace-pre-wrap"><%= simple_format(post.content) %></p>
              </div>

              <!-- Action Buttons -->
              <div class="flex items-center justify-between mt-4">
                <div class="flex space-x-4">
                  <%= link_to post_path(post),
                      class: "text-gray-500 hover:text-blue-500 text-sm flex items-center space-x-1" do %>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                    </svg>
                    <span><%= post.comments_count %> <%= "comment".pluralize(post.comments_count) %></span>
                  <% end %>
                </div>

                <% if post.user == current_user %>
                  <%= link_to post_path(post),
                      method: :delete,
                      data: {
                        confirm: "Are you sure you want to delete this post?"
                      },
                      class: "text-red-500 hover:text-red-700 text-sm" do %>
                    Delete
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    <% else %>
      <div class="bg-white rounded-lg shadow p-8 text-center">
        <p class="text-gray-500">No posts yet. Be the first to share something!</p>
      </div>
    <% end %>
  </div>
</div>

<script>
  // Character counter
  const textarea = document.querySelector('#post_content');
  const charCount = document.querySelector('#char-count');
  const submitBtn = document.querySelector('#post-submit');

  if (textarea) {
    textarea.addEventListener('input', function() {
      const length = this.value.length;
      charCount.textContent = length;

      if (length > 280) {
        charCount.classList.add('text-red-500');
        submitBtn.disabled = true;
      } else {
        charCount.classList.remove('text-red-500');
        submitBtn.disabled = false;
      }
    });
  }
</script>
